# VirtualBoxManagerHandler README

## Overview

The `VirtualBoxManagerHandler` class allows you to automate the interaction with a VirtualBox VM. This includes tasks such as initializing the VirtualBox environment, creating guest sessions, copying files between the host and the guest, running processes inside the VM, and monitoring the execution of these processes.

This class is designed for use in a development environment where tasks on a VirtualBox VM can be automated and managed via a script.

## Prerequisites

Before using this class, ensure the following dependencies are installed:

- Python 3.x
- `python-dotenv` (for loading environment variables)
- `vboxapi` (for interacting with VirtualBox)
- VirtualBox with the required VM set up (Ubuntu in this case)
- A `.env` file to store environment-specific variables

To install the necessary Python packages, run:

```bash
pip install python-dotenv vboxapi
```

## Setup

1. Ensure you have VirtualBox and the required Ubuntu VM configured.
2. Create a `.env` file in the parent directory of this script with the following environment variables:

```env
VM_NAME_UBUNTU=ftpserver
USERNAME_VM_UBUNTU=hsbeyti
PASSWORD_UBUNTU=phd@2005AOU!
LOCAL_FILE=systeminfo.exe
LOCAL_SOURCE_DIR=binaries_to_instrument/
LOCAL_DEST_DIR=instrumented_binaries/
GUEST_DIR=/home/hsbeyti/analysis/
SCRIPT_NAME=run_on_windows_via_ssh.sh
VM_NAME_WINDOWS=malware_analysis
BASE_SNAPSHOT_NAME=BASE_SNAPSHOT
TEST_SNAPSHOT_NAME=run_malware_and_die
VM_USER_WINDOWS=hsbeyti
VM_PASSWORD_WINDOWS=12345678
VBOXMANAGE_PATH_WINDOWS=C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe
```

## Methods

### `__init__(self)`
The constructor initializes the handler and loads the environment variables from the `.env` file.

### `initialize_virtualbox(self)`
Initializes the VirtualBox Manager and creates a session object.

### `locate_machine(self)`
Locates and locks the specified VM (Ubuntu in this case) for interaction.

### `create_guest_session(self)`
Creates a guest session on the locked VM to execute commands.

### `copy_file_to_guest(self, local_file_name, local_file_path="data/", guest_file_path="/home/hsbeyti/analysis/")`
Copies a file from the local machine to the guest VM.

### `copy_file_from_guest_to_host(self, guest_file_name, local_file_path="data/", guest_file_path="/home/hsbeyti/analysis/")`
Copies a file from the guest VM to the local machine.

### `create_process(self, argument, command_to_run, command_time_out)`
Creates a process on the guest VM to run a specified script.

### `monitor_process(self)`
Monitors the status of the process created on the guest VM.

### `process_termination_status(self)`
Checks the termination status of the process.

### `close_session(self)`
Closes the guest session after the task completes.

### `run(self, binary_to_instrument)`
Runs the full process, including copying files, executing the script on the guest VM, and handling results.

## Example Usage

To use this script, simply run the script directly or integrate it into your application. The `run` method is the main entry point, and it will execute the necessary steps.

```python
if __name__ == "__main__":
    vbox_handler = VirtualBoxManagerHandler()
    vbox_handler.run("systeminfox.exe")
```

## License

This project is licensed under the MIT License. See the LICENSE file for more details.

---

This README provides an overview and setup instructions to help you get started with the `VirtualBoxManagerHandler`. If you encounter any issues, feel free to submit an issue or open a pull request.