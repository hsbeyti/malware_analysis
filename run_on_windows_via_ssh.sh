!/bin/bash

# SSH credentials
WINDOWS_USER="hsbeyti"
WINDOWS_HOST="192.178.162.3"
SSH_PASSWORD="12345678"
LOCAL_SCRIPT_PATH="/home/hsbeyti/test.sh"
EXE_PATH="c:\\Users\\hsbeyti\\tools\\execut\\bin"
# Filename variable for the batch file to be executed
SCRIPT_NAME="run.bat"

# Read arguments passed to the script (if any)
ARGS="$@"

# Transfer the local script (you can adjust if you want to send a .bat file instead of .exe)
sshpass -p "$SSH_PASSWORD" scp "$LOCAL_SCRIPT_PATH" ${WINDOWS_USER}@${WINDOWS_HOST}:"$EXE_PATH"

# Construct the command to run the batch file with any arguments passed
COMMAND="cmd.exe /c \"${EXE_PATH}\\${SCRIPT_NAME} ${ARGS}\""

# Execute the command via SSH and capture the output
echo "Executing batch file on ${WINDOWS_HOST}..."

OUTPUT=$(sshpass -p "$SSH_PASSWORD" ssh ${WINDOWS_USER}@${WINDOWS_HOST} "$COMMAND" 2>&1)

# Display the output received from the Windows machine
echo "Batch file output:"
echo "$OUTPUT"

echo "Connection to ${WINDOWS_HOST} closed."
