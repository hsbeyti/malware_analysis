!/bin/bash

#!/bin/bash

# SSH credentials
WINDOWS_USER="hsbeyti"
WINDOWS_HOST="192.178.162.3"
SSH_PASSWORD="12345678"
LOCAL_SCRIPT_PATH="/home/hsbeyti/analysis/"
EXE_PATH="c:\\Users\\hsbeyti\\tools\\execut\\bin"
# Filename variable for the batch file to be executed
SCRIPT_NAME="run.bat"

# Read arguments passed to the script
ARG1=$1            # First argument
shift              # Shift to access remaining arguments
ARG2="$@"          # Remaining arguments (quoted to preserve spaces)

# Debugging output
echo "ARG1: $ARG1"
echo "ARG2: $ARG2"

# Transfer the local script (adjust if you want to send a .bat file instead of .exe)
echo sshpass -p "$SSH_PASSWORD" scp "${LOCAL_SCRIPT_PATH}${ARG2}" ${WINDOWS_USER}@${WINDOWS_HOST}:"$EXE_PATH"
sshpass -p "$SSH_PASSWORD" scp "${LOCAL_SCRIPT_PATH}${ARG2}" ${WINDOWS_USER}@${WINDOWS_HOST}:"$EXE_PATH"

# Construct the command to run the batch file with the specific arguments
COMMAND="cmd.exe /c \"${EXE_PATH}\\${SCRIPT_NAME} ${ARG1}\""

# Execute the command via SSH and capture the output
echo "Executing batch file on ${WINDOWS_HOST}..."

OUTPUT=$(sshpass -p "$SSH_PASSWORD" ssh ${WINDOWS_USER}@${WINDOWS_HOST} "$COMMAND" 2>&1)

# Display the output received from the Windows machine
echo "Batch file output:"
echo "$OUTPUT"

echo "Connection to ${WINDOWS_HOST} closed."
